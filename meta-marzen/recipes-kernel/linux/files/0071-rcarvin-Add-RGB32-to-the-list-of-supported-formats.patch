From 3bc1985b2435c68bc0490005b431302b901eb9d2 Mon Sep 17 00:00:00 2001
From: Phil Edworthy <phil.edworthy@renesas.com>
Date: Fri, 5 Oct 2012 10:46:14 +0100
Subject: [PATCH 71/76] rcarvin: Add RGB32 to the list of supported formats

Signed-off-by: Phil Edworthy <phil.edworthy@renesas.com>
---
 drivers/media/video/rcarvin.c |   25 ++++++++-----------------
 1 files changed, 8 insertions(+), 17 deletions(-)

diff --git a/drivers/media/video/rcarvin.c b/drivers/media/video/rcarvin.c
index 556b06d..2440120 100644
--- a/drivers/media/video/rcarvin.c
+++ b/drivers/media/video/rcarvin.c
@@ -1081,6 +1081,13 @@ static const struct soc_mbus_pixelfmt rcar_vin_formats[] = {
 		.packing		= SOC_MBUS_PACKING_NONE,
 		.order			= SOC_MBUS_ORDER_LE,
 	},
+	{
+		.fourcc			= V4L2_PIX_FMT_RGB32,
+		.name			= "RGB888",
+		.bits_per_sample	= 32,
+		.packing		= SOC_MBUS_PACKING_NONE,
+		.order			= SOC_MBUS_ORDER_LE,
+	},
 };
 
 static int client_g_rect(struct v4l2_subdev *sd, struct v4l2_rect *rect);
@@ -1177,28 +1184,12 @@ static int rcar_vin_get_formats(struct soc_camera_device *icd, unsigned int idx,
 	case V4L2_MBUS_FMT_RGB888_1X24_LE:
 	case V4L2_MBUS_FMT_RGB888_2X12_LE:
 	case V4L2_MBUS_FMT_RGB666_1X18_LE:
-		/* add the sensor native format 'RGB32' */
-		formats++;
-		if (xlate) {
-			xlate->host_fmt	= fmt;
-			xlate->code	= code;
-			dev_dbg(dev, "Providing format %s in pass-through mode\n",
-				xlate->host_fmt->name);
-			xlate++;
-		}
-		/* fall through */
 	case V4L2_MBUS_FMT_YUYV8_1X16:
 	case V4L2_MBUS_FMT_YUYV8_2X8:
 		if (cam->extra_fmt)
 			break;
 
-		/*
-		 * Our case is simple so far: for the above two yuv mediabus
-		 * formats we add all our formats can be generated by VIN,
-		 * since they must include the sensor formats already. For RGB
-		 * mediabus formats, the sensor native format 'RGB32' should be
-		 * appended into the list.
-		 */
+		/* Add all our formats can be generated by VIN */
 		cam->extra_fmt = rcar_vin_formats;
 
 		n = ARRAY_SIZE(rcar_vin_formats);
-- 
1.7.5.4

